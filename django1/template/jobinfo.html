
{% load custumTags %}
{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" data-auto-replace-svg="nest"></script>

    <style>
     * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        font-family: 'Roboto', ;
    }
    .maincontainer {
        width: 100%;
        height: 100vh;
        overflow: hidden;
        background-image: url("{% static 'background.jpg' %}");
        background-position:center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-size: cover;
        position: relative;
    }
    
    
    .nav-container {
        position: sticky;
        top: 0;
        width: 100%;
        height: 3em;
        background-color: transparent;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 0;
        padding: 0;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, .19), 0 6px 20px 0 rgba(0, 0, 0, .20);
    }
    
    .navlist {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        flex-basis: 40%;
        margin-top: 1em;
        height: 100%;
    }
    
    .navlist .nav-li {
        list-style: none;
        position: relative;
    }
    
    .navlist .nav-li::after {
        content: " ";
        position: absolute;
        left: 0;
        bottom: -3px;
        border-bottom: 2px solid #9398ad;
        width: 100%;
        transform: scaleX(0);
        transform-origin: right;
        transition: transform ease-in 150ms;
    }
    
    .navlist .nav-li:hover::after {
        transform: scaleX(1);
        transform-origin: left;
    }
    
    .navlist .nav-a {
        text-decoration: none;
        font-family: 'Open Sans', ;
        letter-spacing: .05em;
        font-size: 1em;
        font-weight: 600;
        text-transform: uppercase;
        color: #9398ad;
    }
     .welcome{
        color: rgb(50, 144, 221);
        font-weight: 600;
        font-size: 1.1em;
        margin-right: 1em;
    }

    .content-container {
        height: 80vh;
        width: 90vW;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.15), 0 6px 20px 0 rgba(0, 0, 0, 0.15);
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-55%);
        display: flex;
        justify-content: center;
        position: relative;
    }
    .hedding-bk{
        position: absolute;
        top: 0;
        left: 50%;
        width: 200px;
        height: 2.5em;
        border-radius: 0.25em;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.15), 0 6px 20px 0 rgba(0, 0, 0, 0.15);
        transform: translate(-50%,-50%);
        background-color: white;
    }
    .hedding{
        font-size: 1.4em;
        position: absolute;
        top: 0;
        left: 50%;
        transform: translate(-50%,-50%);
        font-style: italic;
        font-weight: 600;
        text-shadow: 4px 3px 3px rgba(0, 0, 0, 0.41);
    }
    .faws-icon{
        font-size: 2.5em;
    }

    .containers{
        padding: 1.5em 1em;
        height: 100%;
        width: 90%;
        margin: auto;
        position: absolute;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        align-items: center;
    }


    .service_tags{
        font-size: 1.0em;
        font-weight: 600;
        text-shadow: 5px 4px 2px rgba(0, 0, 0, 0.644);
    }

    .card-container{
        width: 550px;
        height: 40%; 
        margin: 1rem 0rem !important;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, .20), 0 6px 20px 0 rgba(0, 0, 0, .19);
        border-radius: .5em;
        position: relative;
    }
    
    .card-container::before{
        content: attr(data-title);
        position: absolute;
        left: 50%;
        top: 20%;
        width: 200px;
        height: 1.6em;
        border-radius: .25em;
        background-color: white;
        text-align: center;
        color: black;
        z-index: -1;
        transform: translate(-50%,15%);
        transition: top ease-in-out 250ms;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, .20), 0 6px 20px 0 rgba(0, 0, 0, .19);
    }

    .card-container::after{
        content: " ";
        width: 1em;
        height: 1em;
        background-color: rgb(124, 124, 124);
        position: absolute;
        left: 50%;
        top: 10%;
        opacity: 0;
        transform:  translate(-50%,-15%) rotate(45deg);
        transition: opacity top ease-in-out 15ms;
        transition-delay: 0ms;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, .20), 0 6px 20px 0 rgba(0, 0, 0, .19);

    }
    .card-container:hover::before{
         top: -20%;
         z-index: 10;
    }
    .card-container:hover::after{
         transition-delay: 250ms;
         top:-10%;
         opacity: 1;
         transition: opacity top ease-in-out 15ms;
    }
    .card-leftpart{
        flex: 1;
        align-self: stretch;
        overflow-y: hidden;
        scrollbar-width: thin;
        padding: 0em;
        background-color: #717482;
        color: white;
        position: relative;
        box-sizing: content-box;
    }
    .card-leftpart:hover{
        overflow-y: auto;
    }
    
    
    .card-rightpart{
        flex-basis: 25%;
        padding: .5em;
        background-color: whitesmoke;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        align-self: stretch;
        
    }
  

    .filter_container{
        position: absolute;
        right: 0;
        transform: translate(-25%);
        width: 175px;
    }
    #filter_rating,#filter_cat{
        width: 175px;
        background-color: white;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, .050), 0 6px 20px 0 rgba(0, 0, 0, .2);

    }
    .text-h4{
        width: 100%;
        font-size: .9em;
        text-align: center;
    }
    .commenter{
        line-height: 22px;
        font-size: 1em;
        font-weight: 600;
        padding: 0.1em 2em;
        margin: 0;
    }
    .commentdate{
        float: right;
        font-size: 1em;
        word-break: break-all;
    }
    table{
        table-layout: fixed; 
        width:350px;
        margin-left: 1.5em;
        margin-top: .75em;
        margin-bottom: .75em;
    }
    tr{
        border-bottom: 1px solid rgb(168, 168, 168);
        vertical-align: top;
    }
    tr:last-child{
        border: none;
    }
    th{
        font-size: .9em;
        font-weight: 550;
        width: 40%;
        text-align: left;
    }
    td{
        text-align: left;
        word-break: break-all;
    }
    .rightside_image{
        width: 6em;
        height: 7em;
        border-radius: .45em;
        object-fit: cover;
    }
    .back,.updatedbtn{
        height: 25px;
        line-height: 8px;
        margin-top: .5em;
        font-weight: 600;
        color: black !important;
        font-size: .9em;
    }
    .billgenbtn{
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%);
    }
   
    .checked {
        color: orange;
      }
    .errormsg{
        text-shadow: 5px 3px 3px rgba(0, 0, 0, 0.719);
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%);
        font-size: 1.5em;
        word-break: break-all;
    }
    

    .pop-up-overlay{
        display: block;
        z-index: 15;
        background-color: rgba(255, 255, 255, 0.616);
        /* background-image: url("{% static 'background.jpg' %}"); */
        background-position:center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-size: cover;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform-origin: center;
        transform: scale(0);
        transition: transform -120ms ease-in-out 250ms;
    }
    .pop-up-job,.pop-up-rating,.pop-up-bill{
        display: none;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%);
        z-index: 16;
        width: 40%;
        background-color: transparent;
        opacity: 0;
        transition: opacity ease-in-out ;
    }
    .popup-close-btn{
        background-color: transparent;
        padding: 0.5em;
        border: none;
        position: absolute;
        top: 0.25em;
        right: 0.5em;
        cursor: pointer;
    }
    .user_container{
        width: 100%;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, .19), 0 6px 20px 0 rgba(0, 0, 0, .20);
        background-color: white;
        padding: 2em 1.5em;
        border-radius: 0.4em;
    }
    .jobform,.billform,.ratingform{
        width: 90%;
        padding: 2em ;
        border-radius: .45em;
        height: auto;
        margin: auto;
        
    }
    
    textarea{
        background-color:transparent;
        height: 90px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,.2), 0 6px 20px 0 rgba(0,0,0,.2);
    }
    label{
        font-size: 1em;
        font-weight: 600;
        color: black;
    }
    input,select,textarea{
        display: block;
        background-color:rgb(231, 231, 231);
        border: none;
        color: black;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,.1), 0 6px 20px 0 rgba(0,0,0,.1);
        padding: 0.25em 0.75em;
        width: 100%;
        border-radius: .05em;
        overflow: hidden;
    }
    textarea,#id_jobName,#id_resource_cost,#id_labour_cost,#id_bill_pic,#payment_status{
        background-color: transparent;
    }
    label[for="id_bill_pic"]{
        display: block;
    }
    label[for="bill_pic-clear_id"],#bill_pic-clear_id{
        display: none;
    }
    .goback{
        border: 1px solid #9496a2;
        border-radius: .75em;
        padding: 0.2em 1.5em;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, .19),0 6px 20px 0 rgba(0, 0, 0, .20);
         cursor: pointer !important;
    }
    .goback:hover{
        background-color: #9496a2;
        color: white !important;
       
    }
    </style>
</head>
<body>
     <div class="maincontainer" >
         <div class="nav-container">
                    <ul class="navlist">
                        <li  style="margin-left:0;list-style: none;"><a class="goback"  style="color:#000000;font-weight: 650;font-style: italic;text-shadow: 3px 3px 3px rgba(0, 0, 0, .20);" onclick="goback()" >Go Back</a></li>
                    </ul>
                    <ul class="navlist">
                        <li  style="margin-left:0;list-style: none;"><a  style="color:#464850;font-weight: 650;font-style: italic;text-shadow: 3px 3px 3px rgba(0, 0, 0, .20);"><span class="welcome">Welcome</span>{{ request.user.username }}</a></li>
                    </ul>
         </div>
        <div class="content-container" >
           <span class="hedding-bk"></span>
           <h1 class="hedding">Job Details</h1>
           

            <div class="containers">
                  <div class="card-container " onclick="gotoUser('{{Jobobj.provider.uid}}')" data-title="Service Provider" style="cursor: pointer;">
                                    <div class="card-leftpart">
                                        <table> 
                                            <tr>
                                                <th>Name</th>
                                                <td>{{Jobobj.provider.user.username|title}}</td>
                                            </tr>
                                            <tr>
                                                <th>Service Type</th>
                                                <td>{{Jobobj.provider.service_catogory|title}}</td>
                                            </tr>
                                            <tr>
                                                <th>Phone Number</th>
                                                <td>{{Jobobj.provider.phonenumber}}</td>
                                            </tr>
                                            <tr>
                                                <th>Rating</th>
                                                <td>
                                                    {% for x in "stars" %}
                                                        {% if forloop.counter <= Jobobj.provider.rating %}
                                                            <span class="fa fa-star checked"></span>
                                                        {% else %}
                                                            <span class="fa fa-star"></span>
                                                        {% endif %}
                                                    {% endfor %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Description</th>
                                                <td>{{Jobobj.provider.description}}</td>
                                            </tr>
                                        </table> 
                                    </div>
                                    <div class="card-rightpart">
                                           <img class="rightside_image" src="{{Jobobj.provider.profile_pic.url}}" alt="">  
                                    </div>
                  </div> 
                  <div class="card-container " onclick="gotoUser('{{Jobobj.seeker.uid}}')" data-title="Service Seeker" style="cursor: pointer;">
                                     <div class="card-rightpart">
                                            <img class="rightside_image" src="{{Jobobj.seeker.profile_pic.url}}" alt=""> 
                                    </div>
                                    <div class="card-leftpart">
                                        <table> 
                                            <tr>
                                                <th>Name</th>
                                                <td>{{Jobobj.seeker.user.username|title}}</td>
                                            </tr>
                                            <tr>
                                                <th>Phone Number</th>
                                                <td>{{Jobobj.seeker.phonenumber}}</td>
                                            </tr>
                                            <tr>
                                                <th>Rate Status</th>
                                                <td>
                                                    {% if Jobobj.job_id|Check_rated == 'no' %}
                                                        Not yet Rated
                                                    {% else %} 
                                                        {% for x in "stars" %}
                                                            {% if forloop.counter <= Jobobj.comment.rating %}
                                                                <span class="fa fa-star checked"></span>
                                                            {% else %}
                                                                <span class="fa fa-star"></span>
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% endif %}
                                                </td>
                                            </tr>

                                            <tr>
                                                <th>Address</th>
                                                <td>{{Jobobj.seeker.address}}</td>
                                            </tr>
                                            {% if ratingform %}
                                             <tr>
                                                <th ><a class="btn btn-light updatedbtn" onclick="openRatingForm(event,'{{Jobobj.job_id}}')" ><i class="fa fa-star"></i> Rate user for job</a></th>
                                            </tr>
                                            {% endif %}
                                        </table> 
                                    </div>
                                   
                  </div>
                  <div class="card-container " data-title="Job Details">
                                    <div class="card-leftpart">
                                        <table> 
                                            <tr>
                                                <th>Job Type</th>
                                                <td>{{Jobobj.job_title|title}}</td>
                                            </tr>
                                            <tr>
                                                <th>Job Title</th>
                                                <td>{{Jobobj.jobName|title}}</td>
                                            </tr>
                                            <tr>
                                                <th>Date</th>
                                                <td>{{Jobobj.assignDate}}</td>
                                            </tr>
                                            <tr>
                                                <th>Job Status</th>
                                                <td>{{Jobobj.job_status}}</td>
                                            </tr> 
                                            <tr>
                                                <th>Bill Status</th>
                                                <td>{% if Jobobj.payment %}
                                                        Bill Genarated Already 
                                                    {% else %} 
                                                        Bill yet Genarate
                                                    {%endif%}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Description</th>
                                                <td>{{Jobobj.job_discription}}</td>
                                            </tr>
                                            {% if jobform %}
                                             <tr>
                                                <th >
                                                    <a onclick='openJobForm("{{Jobobj.seeker.uid}}","{{Jobobj.provider.uid}}","{{Jobobj.seeker.user.username|title}}","{{Jobobj.provider.user.username|title}}")'  class="btn btn-light updatedbtn" ><i class="fas fa-pen"></i> Update Job</a>
                                                </th>
                                            </tr>
                                            {% endif %}
                                        </table> 
                                    </div>
                                    <div class="card-rightpart">
                                         {% if Jobobj.job_title == "electrician" %}
                                            <i class="fas fa-charging-station faws-icon"></i>
                                        {% elif Jobobj.job_title == "furniture" %}
                                                <i class="fas fa-chair faws-icon"></i>
                                        {% elif Jobobj.job_title == "painting" %}
                                                <i class="fas fa-paint-roller faws-icon"></i>
                                        {% elif Jobobj.job_title == "cleaning" %}
                                                <i class="fas fa-broom faws-icon"></i>
                                        {% else%}
                                                <i class="fas fa-wrench faws-icon"></i>
                                        {% endif %} 
                                    </div>
                  </div>
                  <div class="card-container " data-title="Bill Details">
                        <div class="card-leftpart" >
                            {% if Jobobj.payment %}
                                <table style="margin-left: 7em;"> 
                                <tr>
                                    <th>Payment Status</th>
                                    <td>{{Jobobj.payment.payment_status|title}}</td>
                                </tr>
                                <tr>
                                    <th>Date</th>
                                    <td>{{Jobobj.payment.genaratedDate}}</td>
                                </tr>
                                <tr>
                                    <th>Labour Cost</th>
                                    <td>Rs. {{Jobobj.payment.labour_cost}}</td>
                                </tr>
                                <tr>
                                    <th>Resource Cost</th>
                                    <td>Rs. {{Jobobj.payment.resource_cost}}</td>
                                </tr>
                                <tr>
                                    <th>Total Cost</th>
                                    <td>Rs. {{Jobobj.payment.ammount}}</td>
                                </tr>
                                <tr>
                                    {% if billform %}

                                    <th ><a onclick="openBillForm('{{Jobobj.job_id}}')" class="btn btn-light updatedbtn" ><i class="fas fa-pen"></i> Update Bill</a></th>
                                    
                                    {% endif %}
                                    <th><a href="{{Jobobj.payment.bill_pic.url}}" class="btn btn-light back" ><i class="far fa-eye"></i> View Bill</a></th>
                                </tr>
                            </table>                     
                            {% else %}
                               
                                   {% if billform %}

                                    <a onclick="openBillForm('{{Jobobj.job_id}}')" class="btn btn-light billgenbtn updatedbtn" ><i class="fas fa-pen"></i> Update Bill</a>
                                    
                                    {% else %}
                                        <h1 class="errormsg">Bill is not yet genarated.</h1>    
                                    {% endif %}
                                                  
                            {% endif %}
                            
                        </div>
                                    
                  </div>  
            </div> 
                
        </div>
    </div>
   
   
    <div class="pop-up-overlay">
        
    </div>
    {% if jobform %}
        <div class="pop-up-job">
                    <div class="user_container" >
                        <button class="popup-close-btn" onclick="close_popup_overlay('.pop-up-job')"><i class="fas fa-times fa-2x"></i></button>
                        <form method="POST" class="jobform">
                            <h2>Job update Form</h2>
                            {% csrf_token %} {{ jobform }}
                            <input style="display: none;" type="text" name="formType" value="jobform">
                            <button class="btn btn-dark mt-3" type="submit">Update Job</button>
                        </form>
                    </div>
        </div>
   {% endif %}
    
    {% if ratingform %}
        <div class="pop-up-rating">
                    <div class="user_container" >
                        <button class="popup-close-btn" onclick="close_popup_overlay('.pop-up-rating')"><i class="fas fa-times fa-2x"></i></button>
                        <form method="POST" class="ratingform">
                            <h2>Rateing Form</h2>
                            {% csrf_token %} {{ ratingform }}
                            <label>Rating <span id="rating_count">0</span>/5</label>
                            <br>
                            <input style="display: none;" type="text" name="formType" value="ratingform">
                            <button class="btn btn-dark mt-3" type="submit">Rate</button>
                        </form>
                    </div>
        </div>
   {% endif %}
   {% if billform %}
        <div class="pop-up-bill">
                    <div class="user_container" >
                        <button class="popup-close-btn" onclick="close_popup_overlay('.pop-up-bill')"><i class="fas fa-times fa-2x"></i></button>
                        <form method="POST" enctype="multipart/form-data" class="billform">
                            <h2>Bill update Form</h2>
                            <label for="payment_status">Select Payment Status:</label>    
                            <select name="payment_status" id="payment_status" value="{{Jobobj.payment.payment_status}}">
                                <option value="pending">Pending</option>
                                <option value="done">Paid</option>
                            </select>
                            {% csrf_token %} {{ billform }}
                            <input style="display: none;" type="text" name="formType" value="billform">
                            <button class="btn btn-dark mt-3" type="submit">Update</button>
                        </form>
                    </div>
        </div>
   {% endif %}

    <script>

         

         $('input[name="rating"]').on('change',function(event){
                    var rating = event.target.value
                    $('#rating_count').text(rating)
            })
         function open_popup_overlay(pop_up){
            $('.pop-up-overlay').css('transform','scale(1)')
            $(pop_up).css('display','block')
            $(pop_up).css('opacity','1')
        }

            function close_popup_overlay(pop_up){
            $('.pop-up-overlay').css('transform','scale(0)')
            $(pop_up).css('display','none')
            $(pop_up).css('opacity','0')
        }
         function gotoUser(uid){
                localStorage.setItem("backUrl",window.location.href)
                window.location.href = "{% url 'userhome' user_id='123' %}".replace(/123/,uid)
        }
        const goback = ()=>{
            window.location.href = localStorage.getItem("jobbackUrl")
        }

        {% if jobform %}

            const openJobForm = (seeker_id,provider_id,seeker_name,provider_name) =>{
                open_popup_overlay('.pop-up-job')
                $('label[for="id_seeker_id"]').css('display','none')
                $('label[for="id_provider_id"]').css('display','none')
                $('#id_seeker_name').val(seeker_name)
                $('#id_provider_name').val(provider_name)
                $('#id_seeker_id').val(seeker_id)
                $('#id_provider_id').val(provider_id)
                $('#id_job_title').prop('disabled', 'disabled');
            }

           document.querySelector('.jobform').onsubmit = function(event){
                event.preventDefault()
                close_popup_overlay('.pop-up-job')
                $('#id_job_title').prop('disabled', false);
                document.querySelector('.jobform').submit()
            }

        {% endif %}

        {% if ratingform %}
            const openRatingForm = (event,job_id) =>{
                event.stopImmediatePropagation();
                open_popup_overlay('.pop-up-rating')
                $('#id_comment_job_id').val(job_id);
                $('label[for="id_comment_job_id"]').css('display','none')
                
            }

            document.querySelector('.ratingform').onsubmit = function(event){
                event.preventDefault()
                close_popup_overlay('.pop-up-rating')
                document.querySelector('.ratingform').submit()
            }

           
        {% endif %}
        
        

       
        {% if billform %}
        
            const openBillForm = (job_id) =>{
                open_popup_overlay('.pop-up-bill')
                $('#id_job_id').val(job_id);
                $('#id_job_id').prop('readonly','readonly')
            }
            document.querySelector('.billform').onsubmit = function(event){
                event.preventDefault()
                close_popup_overlay('.pop-up-bill')
                document.querySelector('.billform').submit()
            }

        {% endif %}
    </script>  
</body>
</html>